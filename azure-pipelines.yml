trigger:
- main

stages:
  - stage: 'Build'
    displayName: 'Build'
    jobs:
    - job: 'Build'
      displayName: 'Build job'
      pool:
        vmImage: 'windows-latest'
  
      variables:
        BuildConfiguration: 'Release'
        RestoreBuildProjects: '**/*.csproj'
        TestProjects: '**/*[Tt]ests/*.csproj'

      steps:
      - task: UseDotNet@2
        displayName: 'Use .NET Core sdk 6.0.x'
        inputs:
          version: 6.0.x
      - task: DotNetCoreCLI@2
        displayName: Restore
        inputs:
          command: restore
          projects: '$(RestoreBuildProjects)'

      - task: DotNetCoreCLI@2
        displayName: Build
        inputs:
          projects: '$(RestoreBuildProjects)'
          arguments: '--configuration $(BuildConfiguration)'

      - task: DotNetCoreCLI@2
        displayName: Publish
        inputs:
          command: publish
          publishWebProjects: false
          projects: '**/LookupTableAdminDemo.Api.csproj'
          arguments: '--configuration $(BuildConfiguration) --output $(build.artifactstagingdirectory)'

      - task: CopyFiles@2
        displayName: 'Copy Files to: $(build.artifactstagingdirectory)\AzureDeploy'
        inputs:
          SourceFolder: AzureDeploy
          TargetFolder: '$(build.artifactstagingdirectory)\AzureDeploy'

      - publish: '$(build.artifactstagingdirectory)'
        displayName: 'Publish pipeline artifacts'
        artifact: drop